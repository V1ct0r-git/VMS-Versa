{% extends "base.html" %}

{% block title %}Редактировать ремонт №{{ repair.repairID }} - {{ system_info.system.name }}{% endblock %}

{% block content %}
<div class="container">
    <div class="page-header">
        <div class="page-title-section">
            <h1 class="card-title"><i class="fas fa-tools"></i> Редактировать ремонт №{{ repair.repairID }}</h1>
            <p class="page-subtitle">Изменение записи ремонтных работ</p>
        </div>
        <div class="page-actions">
            <a href="{{ url_for('view_repair', repair_id=repair.repairID) }}" class="btn btn-outline">
                <i class="fas fa-eye"></i> Просмотр
            </a>
            <a href="{{ url_for('repairs') }}" class="btn btn-outline">
                <i class="fas fa-arrow-left"></i> Назад
            </a>
        </div>
    </div>

    <div class="card">
        <div class="card-body">
            <form method="POST" class="form">
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">Автомобиль <span class="required">*</span></label>
                        <select name="car_id" class="form-control" required>
                            <option value="">Выберите автомобиль</option>
                            {% for car in vehicles %}
                            <option value="{{ car.CarID }}" {% if car.CarID == repair.carID %}selected{% endif %}>
                                {{ car.brand }} {{ car.model }} ({{ car.licensePlate }})
                            </option>
                            {% endfor %}
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Тип ремонта <span class="required">*</span></label>
                        <select name="repair_type" class="form-control" required>
                            <option value="engine" {% if repair.repairType == 'engine' %}selected{% endif %}>Двигатель</option>
                            <option value="transmission" {% if repair.repairType == 'transmission' %}selected{% endif %}>Трансмиссия</option>
                            <option value="brakes" {% if repair.repairType == 'brakes' %}selected{% endif %}>Тормоза</option>
                            <option value="electrical" {% if repair.repairType == 'electrical' %}selected{% endif %}>Электрика</option>
                            <option value="body" {% if repair.repairType == 'body' %}selected{% endif %}>Кузов</option>
                            <option value="other" {% if repair.repairType == 'other' %}selected{% endif %}>Другое</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Приоритет <span class="required">*</span></label>
                        <select name="priority" class="form-control" required>
                            <option value="low" {% if repair.priority == 'low' %}selected{% endif %}>Низкий</option>
                            <option value="medium" {% if repair.priority == 'medium' %}selected{% endif %}>Средний</option>
                            <option value="high" {% if repair.priority == 'high' %}selected{% endif %}>Высокий</option>
                            <option value="critical" {% if repair.priority == 'critical' %}selected{% endif %}>Критический</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Статус <span class="required">*</span></label>
                        <select name="status" class="form-control" required>
                            <option value="planned" {% if repair.status == 'planned' %}selected{% endif %}>Запланировано</option>
                            <option value="in_progress" {% if repair.status == 'in_progress' %}selected{% endif %}>В процессе</option>
                            <option value="completed" {% if repair.status == 'completed' %}selected{% endif %}>Завершено</option>
                            <option value="cancelled" {% if repair.status == 'cancelled' %}selected{% endif %}>Отменено</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Дата ремонта</label>
                        <input type="date" name="date" class="form-control" value="{{ repair.date.strftime('%Y-%m-%d') if repair.date else '' }}">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Срок гарантии</label>
                        <input type="date" name="warranty_expiry" class="form-control" value="{{ repair.warrantyExpiry.strftime('%Y-%m-%d') if repair.warrantyExpiry else '' }}">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Причина</label>
                        <input type="text" name="reason" class="form-control" value="{{ repair.reason or '' }}">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Стоимость (₽)</label>
                        <input type="number" step="0.01" name="cost" class="form-control" value="{{ repair.cost or 0 }}" min="0">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Название услуги</label>
                        <input type="text" name="service_name" class="form-control" value="{{ repair.serviceName or '' }}">
                    </div>
                </div>

                <div class="form-group full-width">
                    <label class="form-label">Описание работ</label>
                    <textarea name="description" class="form-control" rows="4">{{ repair.description or '' }}</textarea>
                </div>

                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i>
                        Сохранить изменения
                    </button>
                    <a href="{{ url_for('view_repair', repair_id=repair.repairID) }}" class="btn btn-outline">
                        <i class="fas fa-times"></i>
                        Отмена
                    </a>
                </div>
            </form>
        </div>
    </div>
</div>

{% endblock %}