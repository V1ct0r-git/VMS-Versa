{% extends "base.html" %}

{% block title %}Дашборд - {{ system_info.system.name }}{% endblock %}

{% block head %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/pages/dashboard.css') }}">
{% endblock %}

{% block content %}
<div class="container">
    <!-- Приветствие -->
    <div class="page-header">
        <div class="welcome-section">
            <h1 class="card-title">Добро пожаловать, {{ username }}!</h1>
            <p class="page-subtitle">Текущее состояние системы управления автопарком</p>
        </div>
        <div class="dashboard-actions">

        </div>
    </div>

    <!-- Основная статистика -->
    <div class="stats-container">
        <div class="stat-card">
            <div class="stat-icon">
                <i class="fas fa-car"></i>
            </div>
            <div class="stat-content">
                <div class="stat-value">{{ stats.total_cars }}</div>
                <div class="stat-label">Всего автомобилей</div>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon">
                <i class="fas fa-play-circle"></i>
            </div>
            <div class="stat-content">
                <div class="stat-value">{{ stats.active_cars }}</div>
                <div class="stat-label">Активные</div>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon">
                <i class="fas fa-wrench"></i>
            </div>
            <div class="stat-content">
                <div class="stat-value">{{ stats.maintenance_cars }}</div>
                <div class="stat-label">На ТО</div>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon">
                <i class="fas fa-file-archive"></i>
            </div>
            <div class="stat-content">
                <div class="stat-value">{{ stats.retired_cars }}</div>
                <div class="stat-label">Списаны</div>
            </div>
        </div>
    </div>

    <!-- Второй ряд статистики -->
    <div class="stats-container">
        <div class="stat-card">
            <div class="stat-icon">
                <i class="fas fa-calendar-alt"></i>
            </div>
            <div class="stat-content">
                <div class="stat-value">{{ stats.upcoming_maintenance }}</div>
                <div class="stat-label">Предстоящие ТО (≤30 дней)</div>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon">
                <i class="fas fa-exclamation-triangle"></i>
            </div>
            <div class="stat-content">
                <div class="stat-value">{{ stats.overdue_maintenance }}</div>
                <div class="stat-label">Просроченные ТО</div>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon">
                <i class="fas fa-tasks"></i>
            </div>
            <div class="stat-content">
                <div class="stat-value">{{ stats.high_priority + stats.critical_priority }}</div>
                <div class="stat-label">Высокий приоритет</div>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon">
                <i class="fas fa-money-bill-wave"></i>
            </div>
            <div class="stat-content">
                <div class="stat-value">0 ₽</div>
                <div class="stat-label">Расходы за месяц</div>
            </div>
        </div>
    </div>

    <!-- Основной контент -->
    <div class="dashboard-grid">
        <!-- Последние записи ТО -->
        <div class="dashboard-card">
            <div class="card-header">
                <h3 class="card-title"><i class="fas fa-history"></i> Последние записи ТО</h3>
                <a href="{{ url_for('maintenance_records') }}" class="view-all-link">Просмотреть все</a>
            </div>
            <div class="card-body">
                {% if recent_activities %}
                <div class="recent-activities">
                    {% for activity in recent_activities %}
                    <div class="activity-item">
                        <div class="activity-icon">
                            <i class="fas fa-car"></i>
                        </div>
                        <div class="activity-content">
                            <div class="activity-header">
                                <h4>{{ activity.car_brand }} {{ activity.car_model }}</h4>
                                <span class="activity-date">{{ activity.date }}</span>
                            </div>
                            <div class="activity-details">
                                <span class="activity-type">{{ activity.type_name }}</span>
                                <span class="activity-cost">{{ "{:,.2f}".format(activity.cost) }} ₽</span>
                            </div>
                            <div class="activity-mechanic">
                                <i class="fas fa-user-tie"></i> {{ activity.mechanic_name }}
                            </div>
                        </div>
                        <a href="{{ url_for('view_maintenance', record_id=activity.maintenance_id) }}" class="activity-link">
                            <i class="fas fa-arrow-right"></i>
                        </a>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <div class="no-data">
                    <i class="fas fa-inbox"></i>
                    <p>Нет недавних записей ТО</p>
                    <a href="{{ url_for('add_maintenance') }}" class="btn btn-primary">
                        <i class="fas fa-plus"></i>
                        Добавить запись
                    </a>
                </div>
                {% endif %}
            </div>
        </div>

        <!-- Последние напоминания -->
        <div class="dashboard-card">
            <div class="card-header">
                <h3 class="card-title"><i class="fas fa-bell"></i> Последние напоминания</h3>
                <a href="{{ url_for('reminders') }}" class="view-all-link">Просмотреть все</a>
            </div>
            <div class="card-body">
                {% if latest_reminders %}
                <div class="latest-reminders">
                    {% for reminder in latest_reminders %}
                    <div class="reminder-item">
                        <div class="reminder-icon">
                            {% if reminder.reminderType == 'maintenance' %}
                                <i class="fas fa-wrench"></i>
                            {% elif reminder.reminderType == 'inspection' %}
                                <i class="fas fa-file-signature"></i>
                            {% elif reminder.reminderType == 'insurance' %}
                                <i class="fas fa-shield-alt"></i>
                            {% elif reminder.reminderType == 'license' %}
                                <i class="fas fa-id-card"></i>
                            {% else %}
                                <i class="fas fa-exclamation-circle"></i>
                            {% endif %}
                        </div>
                        <div class="reminder-content">
                            <div class="reminder-header">
                                <h4>{{ reminder.message or 'Напоминание' }}</h4>
                                <span class="reminder-date">{{ reminder.createdAt.strftime('%d.%m.%Y %H:%M') if reminder.createdAt else reminder.remindDate.strftime('%d.%m.%Y') }}</span>
                            </div>
                            <div class="reminder-car">
                                <i class="fas fa-car"></i> {{ reminder.car_brand }} {{ reminder.car_model }}
                            </div>
                            <div class="reminder-type">
                                <span class="badge badge-info">
                                    {{ {
                                        'maintenance': 'ТО',
                                        'inspection': 'Техосмотр',
                                        'insurance': 'Страховка',
                                        'license': 'Лицензия',
                                        'other': 'Другое'
                                    }[reminder.reminderType] }}
                                </span>
                            </div>
                        </div>
                        <a href="{{ url_for('view_reminder', reminder_id=reminder.reminderID) }}" class="reminder-link">
                            <i class="fas fa-arrow-right"></i>
                        </a>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <div class="no-data">
                    <i class="fas fa-inbox"></i>
                    <p>Нет последних напоминаний</p>
                    <a href="{{ url_for('reminders') }}" class="btn btn-primary">
                        <i class="fas fa-plus"></i>
                        Добавить напоминание
                    </a>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

{% endblock %}